<?xml version="1.0" encoding="UTF-8"?>
<AttributeFilterPolicyGroup id="ShibbolethFilterPolicy"
        xmlns="urn:mace:shibboleth:2.0:afp"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="urn:mace:shibboleth:2.0:afp http://shibboleth.net/schema/idp/shibboleth-afp.xsd">

    <!-- Attribute filtering policy which permits the use of all attributes coming in from Azure AD. -->
    <AttributeFilterPolicy id="FilterPolicyObject-Proxy-FromAzure-byIssuer-Type">
        <PolicyRequirementRule xsi:type="Issuer" value="https://sts.windows.net/08a1a72f-fecd-4dae-8cec-471a2fb7c2f1/" />

        <AttributeRule attributeID="azureUpn" permitAny="true" />
        <AttributeRule attributeID="azureObjectId" permitAny="true" />
        <AttributeRule attributeID="azureUserId" permitAny="true" />
        <AttributeRule attributeID="azureUserType" permitAny="true" />
        <AttributeRule attributeID="azureTenantId" permitAny="true" />
        <AttributeRule attributeID="azureDisplayName" permitAny="true" />
        <AttributeRule attributeID="azureGivenName" permitAny="true" />
        <AttributeRule attributeID="azureSurname" permitAny="true" />
        <AttributeRule attributeID="azureMail" permitAny="true" />
    </AttributeFilterPolicy>

    <!-- Attribute filtering policy which releases general attributes to any party the user consented to. -->
    <AttributeFilterPolicy id="Release-General-Attributes">
        <PolicyRequirementRule xsi:type="ANY" />

        <AttributeRule attributeID="uid" permitAny="true"/>
        <AttributeRule attributeID="cn" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="displayName" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="givenName" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="sn" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="mail" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
    </AttributeFilterPolicy>

    <!-- Attribute filtering policy which releases all eduGAIN recommended attributes to trusted relying parties. -->
    <AttributeFilterPolicy id="Release-eduGAIN-Attributes">
        <!-- Only release attributes if... -->
        <PolicyRequirementRule xsi:type="OR">
            <!-- Entity is part of the Research and Scholarship network -->
            <Rule xsi:type="EntityAttributeExactMatch"
                attributeName="http://macedir.org/entity-category"
                attributeValue="http://refeds.org/category/research-and-scholarship" />
            <!-- Or adheres to the GÃ‰ANT Data Protection Code of Conduct -->
            <Rule xsi:type="EntityAttributeExactMatch"
                attributeName="http://macedir.org/entity-category"
                attributeValue="http://www.geant.net/uri/dataprotection-code-of-conduct/v1" />
        </PolicyRequirementRule>

        <AttributeRule attributeID="eduPersonUniqueId" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="eduPersonTargetedID" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="eduPersonPrincipalName" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="eduPersonAffiliation" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="eduPersonScopedAffiliation" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true"/>
        </AttributeRule>
        <AttributeRule attributeID="schacHomeOrganization" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true" />
        </AttributeRule>
        <AttributeRule attributeID="schacHomeOrganizationType" permitAny="true">
            <PermitValueRule xsi:type="AttributeInMetadata" onlyIfRequired="true" />
        </AttributeRule>
    </AttributeFilterPolicy>

    <!-- ESI European Student Identifier -->
    <AttributeFilterPolicy id="Release-EuropeanStudentIdentifier-ForEsiEntityCategory">
        <PolicyRequirementRule xsi:type="EntityAttributeExactMatch"
                attributeName="http://macedir.org/entity-category"
                attributeValue="https://myacademicid.org/entity-categories/esi" />
        <AttributeRule attributeID="schacPersonalUniqueCode">
            <PermitValueRule xsi:type="ValueRegex" regex="^urn:schac:personalUniqueCode:int:esi:.*" />
        </AttributeRule>
    </AttributeFilterPolicy>

    <!-- ANELIS+ attributes -->
    <AttributeFilterPolicy id="ANELISPlusEntitlement">
        <PolicyRequirementRule xsi:type="OR">
            <Rule xsi:type="Requester"
                value="https://portal.anelisplus.ro/simplesaml/module.php/saml/sp/metadata.php/default-sp" />
            <Rule xsi:type="Requester"
                value="https://dspace.anelisplus.ro/shibboleth" />
        </PolicyRequirementRule>

        <!--
        <AttributeRule attributeID="givenName" permitAny="true" />
        <AttributeRule attributeID="sn" permitAny="true" />
        <AttributeRule attributeID="displayName" permitAny="true" />
        <AttributeRule attributeID="mail" permitAny="true" />
        -->
        <!-- <AttributeRule attributeID="eduPersonEntitlement" permitAny="true" /> -->
        <!--
        <AttributeRule attributeID="homeOrganizationAbbr" permitAny="true" />
        <AttributeRule attributeID="homeOrganizationType" permitAny="true" />
        -->
    </AttributeFilterPolicy>

</AttributeFilterPolicyGroup>
